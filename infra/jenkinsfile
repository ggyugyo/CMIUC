pipeline {
    agent any
    
    environment {
        
        CREDITIALSID = "${env.CREDITIALSID}"
        URL = "${env.URL}"
        FRONT_CONTAINER = "${env.FRONT_CONTAINER}"
        BACK_CONTAINER = "${env.BACK_CONTAINER}"
        FRONT_IMAGE = "${env.FRONT_IMAGE}"
        BACK_IMAGE = "${env.BACK_IMAGE}"
        DOCKERCOMPOSE_FILE = "Dockercompose.yml"

    }
    
    stages {
        stage("Checkout") {
            steps {
                script {
                    git credentialsId: "${CREDITIALSID}", url: "${URL}", branch: "master"
                }
            }
        }
        
        stage("delete old frontend") {
            steps {
                sh "docker rm -f ${FRONT_CONTAINER}"
                sh "docker rmi -f ${FRONT_IMAGE}"
            }
        }
        
        stage("delete old backend") {
            steps {
                sh "docker rm -f ${BACK_CONTAINER}"
                sh "docker rmi -f ${BACK_IMAGE}"
            }
        }
        
        stage("Deploy") {
            steps {
                script {
                    sh "docker compose -f ${DOCKERCOMPOSE_FILE} up -d"
                }
            }
        }

    }
}